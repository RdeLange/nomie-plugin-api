"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getComponentAtPosition = void 0;
const documents_1 = require("../../../lib/documents");
const DocumentSnapshot_1 = require("../DocumentSnapshot");
/**
 * If the given original position is within a Svelte starting tag,
 * return the snapshot of that component.
 */
function getComponentAtPosition(lsAndTsDocResovler, lang, doc, tsDoc, fragment, originalPosition) {
    var _a;
    if (tsDoc.parserError) {
        return null;
    }
    if (documents_1.isInTag(originalPosition, doc.scriptInfo) ||
        documents_1.isInTag(originalPosition, doc.moduleScriptInfo)) {
        // Inside script tags -> not a component
        return null;
    }
    const node = documents_1.getNodeIfIsInComponentStartTag(doc.html, doc.offsetAt(originalPosition));
    if (!node) {
        return null;
    }
    const generatedPosition = fragment.getGeneratedPosition(doc.positionAt(node.start + 1));
    const def = (_a = lang.getDefinitionAtPosition(tsDoc.filePath, fragment.offsetAt(generatedPosition))) === null || _a === void 0 ? void 0 : _a[0];
    if (!def) {
        return null;
    }
    const snapshot = lsAndTsDocResovler.getSnapshot(def.fileName);
    if (!(snapshot instanceof DocumentSnapshot_1.SvelteDocumentSnapshot)) {
        return null;
    }
    return snapshot;
}
exports.getComponentAtPosition = getComponentAtPosition;
//# sourceMappingURL=utils.js.map